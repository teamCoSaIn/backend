= TriLo - API Document
:doctype: book
:icons: font
:source-highlighter: highlightjs // 문서에 표기되는 코드들의 하이라이팅을 highlightjs를 사용
:toc: left // toc (Table Of Contents)를 문서의 좌측에 두기
:toclevels: 2
:sectlinks:
:docinfo: shared-head

'''

== Auth API

=== OAuth2 로그인

- 메서드 : GET
- URL : `/api/auth/login/{provider}?redirect_uri={redirectUri}&code={Authorization_Code}`

==== 요청
===== 경로 변수
include::{snippets}/auth-rest-controller-docs-test/로그인_요청/path-parameters.adoc[]
===== 쿼리 변수
include::{snippets}/auth-rest-controller-docs-test/로그인_요청/query-parameters.adoc[]
==== 응답
===== 헤더
include::{snippets}/auth-rest-controller-docs-test/로그인_요청/response-headers.adoc[]
===== 본문
include::{snippets}/auth-rest-controller-docs-test/로그인_요청/response-fields.adoc[]

==== 예제
===== 요청
include::{snippets}/auth-rest-controller-docs-test/로그인_요청/http-request.adoc[]
===== 응답
include::{snippets}/auth-rest-controller-docs-test/로그인_요청/http-response.adoc[]

'''

=== 재발급 토큰 상태 조회
operation::auth-rest-controller-docs-test/재발급_토큰_상태_조회_요청[snippets = 'http-request,http-response,response-fields']

=== 접근 토큰 재발급
operation::auth-rest-controller-docs-test/접근토큰_재발급_요청[snippets = 'http-request,http-response,response-fields']

'''

== Trip API

=== Trip 생성
==== 기본 정보
- 메서드 : GET
- URL : /api/trips
- 인증방식 : 액세스 토큰

현재 로그인 한 사용자 소유의 여행(Trip)을 생성 후, 생성된 여행의 식별자를 반환합니다.

==== 요청
===== 헤더
include::{snippets}/trip-create-controller-docs-test/success-test/request-headers.adoc[]
===== 본문
include::{snippets}/trip-create-controller-docs-test/success-test/request-fields.adoc[]

==== 응답
===== 본문
include::{snippets}/trip-create-controller-docs-test/success-test/response-fields.adoc[]

==== 예제
===== 요청
include::{snippets}/trip-create-controller-docs-test/success-test/http-request.adoc[]

사용자는 지정한 title을 제목으로 한 여행을 생성해달라고 서버에 요청을 합니다.

===== 응답
include::{snippets}/trip-create-controller-docs-test/success-test/http-response.adoc[]

서버는 요청 사항에 맞게 여행을 생성하고, 생성된 여행의 식별자를 반환합니다.

'''

=== Trip 수정

==== 기본 정보
- 메서드 : PUT
- URL : `/api/trips/{tripId}`
- 인증방식 : 액세스 토큰

요청한 여행에 대해서 요청한 제목, 기간으로 여행의 상태를 수정합니다.
수정이 성공됐을 경우, 다시 여행의 식별자를 응답합니다.


==== 요청
===== 헤더
include::{snippets}/trip-update-controller-docs-test/trip-update-doc-test/request-headers.adoc[]
===== 경로 변수(PathVariable)
include::{snippets}/trip-update-controller-docs-test/trip-update-doc-test/path-parameters.adoc[]

- 유효한 여행 식별자(tripId)를 전달해야합니다.

===== 본문
include::{snippets}/trip-update-controller-docs-test/trip-update-doc-test/request-fields.adoc[]

===== 기간 설정 주의 사항
사용자가 시작일과 종료일을 전달한다면 여행의 기간이 해당 기간에 맞게 설정됩니다.
기존에 기간이 설정되어있지 않은 경우(여행을 처음 생성한 상태를 유지할 때) 기간의 초기화가 이 시점에 이루어집니다.

만약 기존에 기간이 정해져있는 상태이고 각각의 Day마다 일정이 있을 때, 새로 변경된 기간에 속하지 않는 Day의 일정들은 임시보관함으로 일괄 이동됩니다.
예를 들어, 2023년 3월 1일부터 2023년 3월 3일까지 잡혀진 여행 기간을 2023년 3월 3일부터 2023년 3월 5일까지의 여행 기간으로 변경할 경우, 새로운 여행 기간에 속하지 않는
2023년 3월 1일부터 2023년 3월 2일까지의 Day에 속한 일정들은 모두 임시보관함으로 이동됩니다.


또, 기존에 기간이 정해져있는 여행에 대해 시작일과 종료일을 둘다 null로 변경할 수 없습니다. 여행 기간이 정해져 있지 않은 상태는 여행 생성 이후 초기화 직전까지에만 가능하며
한번 기간을 초기화한 경우 그 이후에는 기간이 없는 상태로 돌릴 수 없습니다.

여행 기간은 최대 10일까지 설정할 수 있습니다. 최대 가능일수를 초과한 일수의 기간은 설정할 수 없습니다.

==== 응답
===== 본문
include::{snippets}/trip-update-controller-docs-test/trip-update-doc-test/response-fields.adoc[]

==== 예제
===== 요청
include::{snippets}/trip-update-controller-docs-test/trip-update-doc-test/http-request.adoc[]

사용자는 경로변수를 통해 어떤 여행을 수정할 것인지 지정하고, 요청 본문에 변경할 제목, 기간(시작일, 종료일)을 전달합니다.

===== 응답
include::{snippets}/trip-update-controller-docs-test/trip-update-doc-test/http-response.adoc[]


서버는 요청 사항에 맞게 여행을 수정하고, 수정된 여행의 식별자를 다시 반환합니다.

'''

=== Trip 삭제

==== 기본정보
- 메서드 : DELETE
- URL : `/api/trips/{tripId}`
- 인증방식 : 액세스 토큰

요청한 여행을 삭제합니다. 여행의 소유자만 여행을 삭제할 수 있고, 여행이 실제로 존재해야합니다.(여행이 존재하지 않을 경우 예외가 발생합니다.)
여행이 삭제되면, 여행에 속해있는 Day 및 일정들도 모두 일괄적으로 삭제됩니다.

==== 요청
===== 헤더
include::{snippets}/trip-delete-controller-docs-test/trip-delete-doc-test/request-headers.adoc[]

===== 경로 변수(PathVariable)
include::{snippets}/trip-delete-controller-docs-test/trip-delete-doc-test/path-parameters.adoc[]

- 유효한 여행 식별자(tripId)를 전달해야합니다.

==== 응답
===== 본문
성공적으로 여행이 삭제될 경우 본문에 아무 내용도 전달되지 않고, 상태코드로 204 No Content만 전달됩니다.

==== 예제
===== 요청
include::{snippets}/trip-delete-controller-docs-test/trip-delete-doc-test/http-request.adoc[]

사용자는 경로변수를 통해 어떤 여행을 삭제할 것인지 지정합니다.

===== 응답
include::{snippets}/trip-delete-controller-docs-test/trip-delete-doc-test/http-response.adoc[]

여행이 성공적으로 삭제되고(여행에 속한 Day, 일정들도 삭제된 뒤), 응답 본문에 아무 것도 담기지 않은 채
상태코드 204 No Content가 전달됩니다.


'''

=== Trip 조회

==== 기본정보

- 메서드 : GET
- URL : `/api/trips/{tripId}`
- 인증 방식 : 엑세스 토큰

==== 요청
===== 헤더
include::{snippets}/single-trip-query-controller-docs-test/여행_단건_조회/request-headers.adoc[]
===== 경로 변수
include::{snippets}/single-trip-query-controller-docs-test/여행_단건_조회/path-parameters.adoc[]
==== 응답
===== 본문
include::{snippets}/single-trip-query-controller-docs-test/여행_단건_조회/response-fields.adoc[]

==== 예제
===== 요청
include::{snippets}/single-trip-query-controller-docs-test/여행_단건_조회/http-request.adoc[]
===== 응답
include::{snippets}/single-trip-query-controller-docs-test/여행_단건_조회/http-response.adoc[]

'''

=== Schedule 생성

==== 기본 정보

- 메서드 : POST
- URL : `/api/schedules`
- 인증 방식 : 액세스 토큰

일정을 생성합니다.
어느 Trip의 어느 Day에 일정을 생성할 지 지정할 수 있으며, day가 null 이면 해당 Trip(여행)의 임시보관함에 일정이 생성됩니다.
이 때, 전달된 식별자의 Day가 해당 Trip에 속하지 않을 경우, 예외가 발생합니다.

===== 일정 갯수 제약 조건
- 여행 당 일정 갯수 제한 : 1개의 여행은 내부의 Day, 임시보관함을 통틀어 총 110개까지 일정을 가질 수 있습니다. 기존에 110개의 일정이 생성되어 있다면
더 이상 일정을 생성할 수 없습니다.
- Day 당 일정 갯수 제한 : 1개의 Day는 총 10개까지 일정을 가질 수 있습니다. 어떤 Day에 일정이 10개 생성되어 있다면 해당 Day에는 더 이상 일정을 생성할 수 없습니다.
- 임시보관함 일정 생성 제한 : 임시보관함에는 '여행 당 일정 갯수 제한'의 갯수 제한 범위 내에서 일정을 자유롭게 추가할 수 있습니다.

==== 요청
===== 헤더
include::{snippets}/schedule-create-controller-docs-test/schedule-create-doc-test/request-headers.adoc[]

===== 본문
include::{snippets}/schedule-create-controller-docs-test/schedule-create-doc-test/request-fields.adoc[]

===== 좌표(Coordinate) 타입
include::{snippets}/schedule-create-controller-docs-test/schedule-create-doc-test/request-fields-beneath-coordinate.adoc[]

==== 응답
===== 본문
include::{snippets}/schedule-create-controller-docs-test/schedule-create-doc-test/response-fields.adoc[]

==== 예제
===== 요청
include::{snippets}/schedule-create-controller-docs-test/schedule-create-doc-test/http-request.adoc[]

사용자는 어느 Trip의 어느 Day에 일정을 생성할 것인지 지정합니다. 이 때, Trip Id가 null 이면 임시보관함에 삽입되고, dayId가 null 이 아니면
해당 day에 일정이 생성됩니다. (단, 해당 식별자의 Day가 Trip에 속해야합니다!)


===== 응답
include::{snippets}/schedule-create-controller-docs-test/schedule-create-doc-test/http-response.adoc[]

일정이 정상적으로 생성되면, 생성된 일정(Schedule)의 식별자가 반환되고, 상태코드로 201 Created가 전달됩니다.

'''


=== Schedule 수정

==== 기본 정보
- 메서드 : PUT
- URL : `/api/schedules/{scheduleId}`
- 인증 방식 : 액세스 토큰

요청 Schedule의 제목과 본문을 수정하는 API입니다.
이때, Trip, Schedule의 소유자가 아닌 사람이 일정을 수정하려 시도할 경우 예외가 발생합니다.

==== 요청
===== 헤더
include::{snippets}/schedule-update-controller-docs-test/schedule-update-doc-test/request-headers.adoc[]
===== 경로 변수
include::{snippets}/schedule-update-controller-docs-test/schedule-update-doc-test/path-parameters.adoc[]
===== 본문
include::{snippets}/schedule-update-controller-docs-test/schedule-update-doc-test/request-fields.adoc[]

==== 응답
===== 본문
include::{snippets}/schedule-update-controller-docs-test/schedule-update-doc-test/response-fields.adoc[]


==== 예제
===== 요청
include::{snippets}/schedule-update-controller-docs-test/schedule-update-doc-test/http-request.adoc[]

사용자는 경로 변수를 통해 수정하고자 하는 여행의 식별자를 전달하고, 본문을 통해 어떤 제목/본문으로 변경할지 전달합니다.

===== 응답
include::{snippets}/schedule-update-controller-docs-test/schedule-update-doc-test/http-response.adoc[]

정상적으로 일정이 수정됐을 경우, 일정의 식별자를 본문으로 담고 상태코드 200 Ok 를 함께 응답합니다.

'''

=== Schedule 조회

==== 기본 정보

- 메서드 : GET
- URL : `/api/schedules/{scheduleId}`
- 인증 방식 : 엑세스 토큰

==== 요청
===== 헤더
include::{snippets}/single-schedule-query-controller-docs-test/일정_단건_조회/request-headers.adoc[]
===== 경로 변수
include::{snippets}/single-schedule-query-controller-docs-test/일정_단건_조회/path-parameters.adoc[]

==== 응답
===== 본문
include::{snippets}/single-schedule-query-controller-docs-test/일정_단건_조회/response-fields.adoc[]

==== 예제
===== 요청
include::{snippets}/single-schedule-query-controller-docs-test/일정_단건_조회/http-request.adoc[]
===== 응답
include::{snippets}/single-schedule-query-controller-docs-test/일정_단건_조회/http-response.adoc[]

'''

=== Day 조회

==== 기본 정보

- 메서드 : GET
- URL : '/api/days/{dayId}'
- 인증 방식 : 엑세스 토큰

==== 요청
===== 헤더
include::{snippets}/single-day-query-controller-docs-test/day_단건_조회/request-headers.adoc[]
===== 경로 변수
include::{snippets}/single-day-query-controller-docs-test/day_단건_조회/path-parameters.adoc[]

==== 응답
===== 본문
include::{snippets}/single-day-query-controller-docs-test/day_단건_조회/response-fields.adoc[]

==== 예제
===== 요청
include::{snippets}/single-day-query-controller-docs-test/day_단건_조회/http-request.adoc[]
===== 응답
include::{snippets}/single-day-query-controller-docs-test/day_단건_조회/http-response.adoc[]

'''
